<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Harper Bowie</title>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/lottie-player/2.0.8/lottie-player.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    html {
      overflow: hidden;
      height: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: white;
      overflow: hidden;
      height: 100%;
    }

    /* 页面指示器 */
    .page-indicators {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 100;
      transition: opacity 0.3s ease;
    }

    .indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .indicator.active {
      background: rgba(0, 0, 0, 0.6);
      transform: scale(1.3);
    }

    .indicator:hover {
      background: rgba(0, 0, 0, 0.4);
    }

    /* 全屏容器 */
    .fullpage-container {
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    .sections-wrapper {
      height: 100%;
      transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
      will-change: transform;
    }

    .section {
      height: 100vh;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      opacity: 0;
      transform: translateY(30px) scale(0.95);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .section.active {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .section.prev {
      opacity: 0;
      transform: translateY(-30px) scale(0.95);
    }

    /* Hero Section */
    .hero {
      padding: 40px 20px;
      perspective: 1000px;
    }

    .card-container {
      width: 350px;
      height: 200px;
      position: relative;
      transition: transform 0.1s ease-out;
      transform-style: preserve-3d;
      margin-bottom: 40px;
    }

    .card {
      width: 100%;
      height: 100%;
      position: absolute;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .card-face {
      width: 100%;
      height: 100%;
      position: absolute;
      backface-visibility: hidden;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px;
    }

    .card-front {
      font-family: 'Georgia', 'Times New Roman', serif;
      font-style: italic;
      font-size: 32px;
      color: #1a1a1a;
      text-align: center;
      text-shadow: 
        0 1px 0 rgba(255,255,255,0.3),
        0 -1px 0 rgba(0,0,0,0.15),
        0 2px 3px rgba(0,0,0,0.1);
      letter-spacing: 0.5px;
    }

    .card-back {
      transform: rotateY(180deg);
      flex-direction: column;
      gap: 10px;
      padding: 25px;
    }

    .card-back-line1 {
      font-family: 'Georgia', 'Times New Roman', serif;
      font-style: italic;
      font-size: 18px;
      color: #1a1a1a;
      text-align: center;
      text-shadow: 
        0 1px 0 rgba(255,255,255,0.3),
        0 -1px 0 rgba(0,0,0,0.15),
        0 2px 3px rgba(0,0,0,0.1);
      letter-spacing: 0.3px;
    }

    .card-back-line2 {
      font-family: 'Georgia', 'Times New Roman', serif;
      font-style: italic;
      font-size: 18px;
      color: #666;
      text-align: center;
      text-shadow: 
        0 1px 0 rgba(255,255,255,0.25),
        0 -1px 0 rgba(0,0,0,0.1),
        0 1px 2px rgba(0,0,0,0.08);
      letter-spacing: 0.3px;
    }

    .card-back-line3 {
      font-family: 'Georgia', 'Times New Roman', serif;
      font-style: italic;
      font-size: 13px;
      color: #888;
      text-align: center;
      text-shadow: 
        0 1px 0 rgba(255,255,255,0.2),
        0 -1px 0 rgba(0,0,0,0.08),
        0 1px 2px rgba(0,0,0,0.06);
      letter-spacing: 0.2px;
      margin-top: 6px;
    }

    .contact-btn {
      padding: 12px 32px;
      background: white;
      color: black;
      border: none;
      border-radius: 24px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
    }

    .contact-btn:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
      transform: translateY(-1px);
    }

    .contact-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* About Section */
    .about {
      padding: 80px 20px;
      max-width: 700px;
      margin: 0 auto;
      align-items: flex-start;
    }

    .about h2 {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      font-style: normal;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 30px;
      color: #1d1d1f;
    }

    .about-content {
      max-width: 700px;
      width: 100%;
    }

    .about-list {
      margin-bottom: 50px;
    }

    .about-list div {
      font-size: 16px;
      line-height: 1.8;
      margin-bottom: 12px;
      color: #1d1d1f;
    }

    /* Secret Section */
    .secret {
      padding: 80px 20px;
      background: white;
      justify-content: flex-start;
      padding-top: 22vh;
      position: relative;
    }
    
    @media (min-width: 769px) {
      .secret {
        justify-content: center;
        padding-top: 80px;
      }
    }
    
    /* 移动端双输入框方案 */
    @media (max-width: 768px) {
      .secret {
        padding-top: 80px;
      }
      
      /* 隐藏桌面端 input */
      .desktop-input {
        display: none !important;
      }
      
      /* 真输入框：在顶部，完全透明且禁止直接点击 */
      .real-input-container {
        position: absolute;
        top: 8vh;
        left: 50%;
        transform: translateX(-50%);
        z-index: -1; /* 放到下层，防止误触 */
        opacity: 0;
        pointer-events: none; /* 禁止点击 */
      }
      
      .real-input {
        padding: 0 16px;
        border: none;
        border-radius: 14px;
        font-size: 16px;
        outline: none;
        width: 280px;
        height: 50px;
        background: transparent;
        color: transparent;
        caret-color: transparent;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        pointer-events: auto; /* input 本身可以接收焦点 */
      }
      
      .real-input::placeholder {
        color: transparent;
      }
      
      /* 假输入框容器：在中间，始终可见 */
      .secret-input-container {
        position: absolute;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      
      /* 假输入框的内容区域 */
      .fake-display {
        display: flex;
        align-items: center;
        justify-content: flex-start;
      }
      
      .fake-text {
        white-space: nowrap;
        overflow: hidden;
      }
      
      /* 假输入框的光标 - 奶白色，用阴影在白色背景上显现 */
      .fake-cursor {
        display: none;
        width: 2px;
        height: 1.2em;
        background: linear-gradient(180deg, 
          rgba(255, 253, 245, 0.95) 0%,
          rgba(250, 245, 235, 0.9) 100%
        );
        border-radius: 1px;
        vertical-align: middle;
        animation: cursor-glow 1s ease-in-out infinite;
        flex-shrink: 0;
        margin-left: 1px;
        box-shadow: 
          0 0 1px rgba(0, 0, 0, 0.15),
          0 0 3px rgba(200, 180, 150, 0.3),
          0 0 6px rgba(255, 245, 220, 0.4);
      }
      
      /* 聚焦时显示光标 */
      .fake-display.focused .fake-cursor {
        display: inline-block;
      }
      
      /* 聚焦时如果是 placeholder 状态，隐藏 placeholder 文字 */
      .fake-display.focused .fake-text.placeholder {
        display: none;
      }
      
      @keyframes cursor-glow {
        0%, 100% { 
          opacity: 1;
          box-shadow: 
            0 0 1px rgba(0, 0, 0, 0.15),
            0 0 3px rgba(200, 180, 150, 0.3),
            0 0 6px rgba(255, 245, 220, 0.4);
        }
        50% { 
          opacity: 0.15;
          box-shadow: 
            0 0 1px rgba(0, 0, 0, 0.08),
            0 0 2px rgba(200, 180, 150, 0.15);
        }
      }
    }
    
    /* 桌面端 */
    @media (min-width: 769px) {
      /* 隐藏移动端的真输入框容器 */
      .real-input-container {
        display: none !important;
      }
      
      /* 隐藏假输入框显示层 */
      .fake-display {
        display: none !important;
      }
      
      /* 显示桌面端 input */
      .desktop-input {
        display: block !important;
      }
      
      /* 桌面端 lift 状态时隐藏 placeholder */
      .desktop-input.lift::placeholder {
        opacity: 0;
      }
    }

    /* iOS Safari 专用修复 */
    @media (max-width: 768px) {
      .ios .secret {
        width: 100%;
        overflow: visible;
      }
      .ios .secret-input-container {
        position: absolute;
        top: 50%;
        left: 50%;
        right: auto;
        transform: translate(-50%, -50%);
      }
    }

    .secret-input-container {
      display: flex;
      gap: 12px;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    /* 输入框包装器 */
    .secret-input-wrapper {
      position: relative;
    }

    /* 输入框底部发光 - 单一暖黄色，通过大小和透明度变化 */
    .secret-input-wrapper::before {
      content: '';
      position: absolute;
      left: -8px;
      right: -8px;
      top: -6px;
      bottom: -6px;
      pointer-events: none;
      z-index: -1;
      border-radius: 14px;
      transition: 
        opacity 1.4s cubic-bezier(0.19, 1, 0.22, 1),
        filter 1.4s cubic-bezier(0.19, 1, 0.22, 1),
        left 1.4s cubic-bezier(0.19, 1, 0.22, 1),
        right 1.4s cubic-bezier(0.19, 1, 0.22, 1),
        top 1.4s cubic-bezier(0.19, 1, 0.22, 1),
        bottom 1.4s cubic-bezier(0.19, 1, 0.22, 1);
      /* 近时：小而亮 */
      filter: blur(8px);
      opacity: 0.95;
      /* 统一的暖黄色 */
      background: radial-gradient(
        ellipse 90% 90% at center center,
        rgba(255, 240, 200, 1) 0%,
        rgba(255, 230, 180, 0.75) 40%,
        rgba(255, 220, 160, 0.35) 70%,
        transparent 100%
      );
    }

    /* 输入框抬起时 - 四周均匀扩散 */
    .secret-input-wrapper.lift::before {
      left: -25px;
      right: -25px;
      top: -25px;
      bottom: -25px;
      filter: blur(22px);
      opacity: 0.4;
    }

    /* 按钮包装器 */
    .secret-btn-wrapper {
      position: relative;
    }

    /* 按钮底部发光 - 单一暖黄色，通过大小和透明度变化 */
    .secret-btn-wrapper::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: -1;
      border-radius: 14px;
      transition: 
        opacity 1.4s cubic-bezier(0.19, 1, 0.22, 1),
        filter 1.4s cubic-bezier(0.19, 1, 0.22, 1),
        width 1.4s cubic-bezier(0.19, 1, 0.22, 1),
        height 1.4s cubic-bezier(0.19, 1, 0.22, 1);
      /* 近时：小而亮 */
      width: 112%;
      height: 112%;
      filter: blur(8px);
      opacity: 0.95;
      /* 统一的暖黄色 */
      background: radial-gradient(
        ellipse 90% 90% at center center,
        rgba(255, 240, 200, 1) 0%,
        rgba(255, 230, 180, 0.75) 40%,
        rgba(255, 220, 160, 0.35) 70%,
        transparent 100%
      );
    }

    /* 按钮抬起时 - 大而暗 */
    .secret-btn-wrapper.lift::before {
      width: 165%;
      height: 175%;
      filter: blur(22px);
      opacity: 0.4;
    }

    /* 防止两个光源靠近时中间过亮 */
    .secret-input-container.active .secret-input-wrapper::before,
    .secret-input-container.active .secret-btn-wrapper::before {
      opacity: 0.8;
    }

    .secret-input-container.active .secret-input-wrapper.lift::before,
    .secret-input-container.active .secret-btn-wrapper.lift::before {
      opacity: 0.55;
    }

    .secret-input {
      padding: 0 16px;
      border: none;
      border-radius: 14px;
      font-size: 15px;
      outline: none;
      width: 280px;
      height: 50px;
      line-height: 50px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(30px) saturate(180%);
      box-shadow: 
        inset 0 1px 2px rgba(255, 255, 255, 0.5),
        inset 0 -1px 2px rgba(0, 0, 0, 0.03),
        0 2px 4px rgba(0, 0, 0, 0.08),
        0 4px 8px rgba(0, 0, 0, 0.06),
        0 8px 16px rgba(0, 0, 0, 0.04);
      transition: all 1.8s cubic-bezier(0.19, 1, 0.22, 1);
      color: #1d1d1f;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      position: relative;
      -webkit-user-select: text;
      user-select: text;
      caret-color: rgba(180, 170, 155, 0.8);
    }

    .secret-input::placeholder {
      color: rgba(0, 0, 0, 0.3);
      font-weight: 300;
      letter-spacing: 0.3px;
      transition: all 1.8s cubic-bezier(0.19, 1, 0.22, 1);
    }

    .secret-input.lift {
      background: rgba(255, 255, 255, 1);
      box-shadow: 
        inset 0 1px 2px rgba(255, 255, 255, 0.6),
        inset 0 -1px 2px rgba(0, 0, 0, 0.02),
        0 4px 8px rgba(0, 0, 0, 0.1),
        0 8px 16px rgba(0, 0, 0, 0.08),
        0 16px 32px rgba(0, 0, 0, 0.06);
      transform: translateY(-6px);
      color: #000;
    }

    .secret-input.lift::placeholder {
      color: rgba(0, 0, 0, 0.4);
      transform: translateX(2px);
    }

    .secret-btn {
      width: 50px;
      height: 50px;
      border: none;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(30px) saturate(180%);
      color: rgba(0, 0, 0, 0.4);
      font-size: 16px;
      cursor: pointer;
      transition: all 1.8s cubic-bezier(0.19, 1, 0.22, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 
        inset 0 1px 2px rgba(255, 255, 255, 0.5),
        inset 0 -1px 2px rgba(0, 0, 0, 0.03),
        0 2px 4px rgba(0, 0, 0, 0.08),
        0 4px 8px rgba(0, 0, 0, 0.06),
        0 8px 16px rgba(0, 0, 0, 0.04);
      flex-shrink: 0;
      position: relative;
    }

    .secret-btn.lift {
      background: rgba(255, 255, 255, 1);
      color: rgba(0, 0, 0, 0.7);
      box-shadow: 
        inset 0 1px 2px rgba(255, 255, 255, 0.6),
        inset 0 -1px 2px rgba(0, 0, 0, 0.02),
        0 4px 8px rgba(0, 0, 0, 0.1),
        0 8px 16px rgba(0, 0, 0, 0.08),
        0 16px 32px rgba(0, 0, 0, 0.06);
      transform: translateY(-6px);
    }

    .secret-btn:active {
      transform: translateY(-3px) scale(0.99);
    }

    .easter-egg {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 100px;
      z-index: 1000;
      pointer-events: none;
      animation: heartbeat 0.6s ease-in-out infinite;
    }

    @keyframes heartbeat {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
    }

    /* 彩蛋动画 */
    @keyframes eggFadeIn {
      from { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    @keyframes eggFadeOut {
      from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      to { opacity: 0; transform: translate(-50%, -50%) scale(1.2); }
    }

    .firework {
      position: fixed;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      pointer-events: none;
      z-index: 999;
    }

    @media (max-width: 768px) {
      .card-container {
        width: 300px;
        height: 170px;
      }

      .card-front {
        font-size: 26px;
      }

      .card-back-line1,
      .card-back-line2 {
        font-size: 16px;
      }

      .about h2 {
        font-size: 20px;
      }

      .about-list div {
        font-size: 14px;
      }

      .page-indicators {
        right: 12px;
      }

      .indicator {
        width: 6px;
        height: 6px;
      }
    }
  </style>
</head>
<body>

  <!-- 页面指示器 -->
  <div class="page-indicators">
    <div class="indicator active" data-page="0"></div>
    <div class="indicator" data-page="1"></div>
    <div class="indicator" data-page="2"></div>
  </div>

  <div class="fullpage-container">
    <div class="sections-wrapper" id="sectionsWrapper">
      
      <section class="section hero active" id="hero">
        <div class="card-container" id="cardContainer">
          <div class="card" id="card">
            <div class="card-face card-front">
              Harper Bowie
            </div>
            <div class="card-face card-back">
              <div class="card-back-line1">Curious about what's next.</div>
              <div class="card-back-line2">Learning by doing.</div>
              <div class="card-back-line3">harper.ops.work@gmail.com</div>
            </div>
          </div>
        </div>
        <a href="mailto:harper.ops.work@gmail.com" class="contact-btn" id="contactBtn">Contact Me</a>
      </section>

      <section class="section about" id="about">
        <h2>Harper Bowie</h2>
        <div class="about-content">
          <div class="about-list">
            <div>• 独立搭建并维护海外服务器与私人独享节点</div>
            <div>• 理解网络与基础设施的真实工作方式</div>
            <div>• 持续关注并参与 Web3 与去中心化生态</div>
          </div>
          <div class="about-list">
            <div>• Independently build and maintain overseas servers and a private dedicated node</div>
            <div>• Understand how networks and infrastructure actually work</div>
            <div>• Actively following and participating in Web3 and decentralized ecosystems</div>
          </div>
        </div>
      </section>

      <section class="section secret" id="secret">
        <!-- 真输入框：移动端在顶部，简单无光效 -->
        <div class="real-input-container" id="realInputContainer">
          <input type="text" class="real-input" id="secretInput" placeholder="type something...">
        </div>
        
        <!-- 假输入框 + 按钮：移动端在中间，完整动画 -->
        <div class="secret-input-container" id="secretContainer">
          <div class="secret-input-wrapper" id="inputWrapper">
            <!-- 桌面端用这个真 input -->
            <input type="text" class="secret-input desktop-input" id="desktopInput" placeholder="type something...">
            <!-- 移动端用这个假显示层 -->
            <div class="secret-input fake-display" id="fakeInput"><span class="fake-text placeholder" style="color: rgba(0, 0, 0, 0.3);">type something...</span><span class="fake-cursor"></span></div>
          </div>
          <div class="secret-btn-wrapper" id="btnWrapper">
            <button class="secret-btn" id="secretBtn">➤</button>
          </div>
        </div>
      </section>

    </div>
  </div>

  <script>
    // ==================== iOS 检测和样式修复 ====================
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    
    if (isIOS) {
      document.documentElement.classList.add('ios');
    }
    
    // ==================== 全屏滚动控制 ====================
    const sectionsWrapper = document.getElementById('sectionsWrapper');
    const sections = document.querySelectorAll('.section');
    const indicators = document.querySelectorAll('.indicator');
    const totalPages = sections.length;
    
    let currentPage = 0;
    let isAnimating = false;
    let animationDuration = 800; // 与 CSS transition 时间一致
    
    // 触摸相关变量
    let touchStartY = 0;
    let touchEndY = 0;
    let touchStartTime = 0;
    const swipeThreshold = 50; // 最小滑动距离
    const swipeTimeThreshold = 300; // 快速滑动的时间阈值
    
    // 输入框焦点状态
    let isInputFocused = false;
    
    // 第三页时指示器的固定像素位置
    let indicatorFixedTop = null;

    // 跳转到指定页面
    function goToPage(pageIndex, direction = null) {
      if (isAnimating || pageIndex === currentPage) return;
      if (pageIndex < 0 || pageIndex >= totalPages) return;
      
      isAnimating = true;
      
      const prevPage = currentPage;
      currentPage = pageIndex;
      
      const realIndicators = document.querySelector('.page-indicators');
      
      // 即将进入第三页：在动画开始前就无感切换
      if (currentPage === 2 && !fakeIndicatorsEl) {
        // 立即隐藏真指示器
        realIndicators.style.visibility = 'hidden';
        realIndicators.style.opacity = '0';
        
        // 立即创建并显示假指示器
        fakeIndicatorsEl = realIndicators.cloneNode(true);
        fakeIndicatorsEl.classList.add('fake-indicators');
        fakeIndicatorsEl.style.visibility = 'visible';
        fakeIndicatorsEl.style.opacity = '1';
        fakeIndicatorsEl.style.transition = 'opacity 0.3s ease';
        document.body.appendChild(fakeIndicatorsEl);
        
        // 同步激活状态到第三个点
        const fakeIndicatorDots = fakeIndicatorsEl.querySelectorAll('.indicator');
        fakeIndicatorDots.forEach((dot, index) => {
          dot.classList.toggle('active', index === 2);
        });
      }
      
      // 离开第三页：无感切换回真指示器
      if (prevPage === 2 && currentPage !== 2 && fakeIndicatorsEl) {
        // 立即删除假指示器
        fakeIndicatorsEl.remove();
        fakeIndicatorsEl = null;
        
        // 立即显示真指示器
        realIndicators.style.visibility = 'visible';
        realIndicators.style.opacity = '1';
      }
      
      // 更新 wrapper 位置
      sectionsWrapper.style.transform = `translateY(-${currentPage * 100}vh)`;
      
      // 更新 section 状态
      sections.forEach((section, index) => {
        section.classList.remove('active', 'prev');
        if (index === currentPage) {
          section.classList.add('active');
        } else if (index < currentPage) {
          section.classList.add('prev');
        }
      });
      
      // 更新指示器（真指示器，虽然在第三页时隐藏但还是要更新状态）
      indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentPage);
      });
      
      // 动画完成后解锁
      setTimeout(() => {
        isAnimating = false;
      }, animationDuration);
    }

    // 下一页
    function nextPage() {
      if (currentPage < totalPages - 1) {
        goToPage(currentPage + 1, 'down');
      }
    }

    // 上一页
    function prevPage() {
      if (currentPage > 0) {
        goToPage(currentPage - 1, 'up');
      }
    }

    // ==================== 鼠标滚轮事件 ====================
    let wheelTimeout = null;
    let lastWheelTime = 0;
    const wheelCooldown = 100; // 滚轮事件冷却时间

    document.addEventListener('wheel', (e) => {
      if (isInputFocused) return; // 输入框聚焦时不处理滚动
      
      e.preventDefault();
      
      const now = Date.now();
      if (now - lastWheelTime < wheelCooldown) return;
      lastWheelTime = now;
      
      if (isAnimating) return;
      
      if (e.deltaY > 0) {
        nextPage();
      } else if (e.deltaY < 0) {
        prevPage();
      }
    }, { passive: false });

    // ==================== 触摸事件 ====================
    document.addEventListener('touchstart', (e) => {
      // 如果是在输入框内触摸，不阻止
      if (e.target === secretInput || e.target.closest('.secret-input-container')) {
        return;
      }
      
      touchStartY = e.touches[0].clientY;
      touchStartTime = Date.now();
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
      if (isInputFocused) return;
      if (e.target === secretInput || e.target.closest('.secret-input-container')) {
        return;
      }
      
      // 阻止默认滚动行为
      e.preventDefault();
    }, { passive: false });

    document.addEventListener('touchend', (e) => {
      if (isInputFocused) return;
      if (e.target === secretInput || e.target.closest('.secret-input-container')) {
        return;
      }
      
      touchEndY = e.changedTouches[0].clientY;
      const touchDuration = Date.now() - touchStartTime;
      const swipeDistance = touchStartY - touchEndY;
      
      // 判断是否为有效滑动
      const isQuickSwipe = touchDuration < swipeTimeThreshold;
      const isValidSwipe = Math.abs(swipeDistance) > swipeThreshold;
      
      if (isAnimating) return;
      
      if (isValidSwipe || (isQuickSwipe && Math.abs(swipeDistance) > 30)) {
        if (swipeDistance > 0) {
          // 向上滑动 -> 下一页
          nextPage();
        } else {
          // 向下滑动 -> 上一页
          prevPage();
        }
      }
    }, { passive: true });

    // ==================== 键盘事件 ====================
    document.addEventListener('keydown', (e) => {
      if (isInputFocused) return;
      if (isAnimating) return;
      
      switch(e.key) {
        case 'ArrowDown':
        case 'PageDown':
        case ' ':
          e.preventDefault();
          nextPage();
          break;
        case 'ArrowUp':
        case 'PageUp':
          e.preventDefault();
          prevPage();
          break;
        case 'Home':
          e.preventDefault();
          goToPage(0);
          break;
        case 'End':
          e.preventDefault();
          goToPage(totalPages - 1);
          break;
      }
    });

    // ==================== 指示器点击 ====================
    indicators.forEach((indicator) => {
      indicator.addEventListener('click', () => {
        const pageIndex = parseInt(indicator.dataset.page);
        goToPage(pageIndex);
      });
    });

    // ==================== 输入框焦点管理 ====================
    
    const secretSection = document.getElementById('secret');
    const realInputContainer = document.getElementById('realInputContainer');
    const fakeInput = document.getElementById('fakeInput');
    const secretContainer = document.getElementById('secretContainer');
    const inputWrapper = document.getElementById('inputWrapper');
    const btnWrapper = document.getElementById('btnWrapper');
    const secretBtn = document.getElementById('secretBtn');
    
    const isMobile = window.innerWidth < 768;
    
    // 移动端用顶部的真输入框，桌面端用容器内的桌面输入框
    const secretInput = isMobile 
      ? document.getElementById('secretInput') 
      : document.getElementById('desktopInput');
    
    // 立即绑定点击事件
    
    if (isMobile && fakeInput) {
      // 点击假输入框时聚焦真输入框
      fakeInput.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        secretInput.focus();
      });
      fakeInput.addEventListener('touchend', (e) => {
        e.preventDefault();
        e.stopPropagation();
        // Safari 要求 focus 必须在同步代码中调用
        secretInput.focus();
      });
    } else if (fakeInput) {
      // 桌面端：隐藏假输入框显示层
      fakeInput.style.display = 'none';
    }
    
    // 移动端：页面加载时就固定所有 section 为 px
    let fixedPageHeight = window.innerHeight;
    
    function lockAllSections() {
      if (window.innerWidth >= 768) return;
      
      fixedPageHeight = window.innerHeight;
      sections.forEach((s, i) => {
        s.style.height = fixedPageHeight + 'px';
        s.style.minHeight = fixedPageHeight + 'px';
      });
      sectionsWrapper.style.transform = `translateY(-${currentPage * fixedPageHeight}px)`;
    }
    
    if (isMobile) {
      lockAllSections();
    }
    
    // 修改 goToPage 函数使用固定高度
    goToPage = function(pageIndex, direction = null) {
      if (isAnimating || pageIndex === currentPage) return;
      if (pageIndex < 0 || pageIndex >= totalPages) return;
      
      isAnimating = true;
      const prevPage = currentPage;
      currentPage = pageIndex;
      
      
      // 进入第二页时预加载彩蛋数据
      if (currentPage >= 1) {
        preloadEggs();
      }
      
      const realIndicators = document.querySelector('.page-indicators');
      
      // 进入第三页：把指示器改成固定像素定位
      if (currentPage === 2 && prevPage !== 2) {
        indicatorFixedTop = fixedPageHeight / 2;
        realIndicators.style.top = indicatorFixedTop + 'px';
      }
      
      // 离开第三页：恢复百分比定位
      if (prevPage === 2 && currentPage !== 2) {
        realIndicators.style.top = '50%';
        indicatorFixedTop = null;
      }
      
      if (window.innerWidth < 768) {
        sectionsWrapper.style.transform = `translateY(-${currentPage * fixedPageHeight}px)`;
      } else {
        sectionsWrapper.style.transform = `translateY(-${currentPage * 100}vh)`;
      }
      
      sections.forEach((section, index) => {
        section.classList.remove('active', 'prev');
        if (index === currentPage) {
          section.classList.add('active');
        } else if (index < currentPage) {
          section.classList.add('prev');
        }
      });
      
      indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentPage);
      });
      
      setTimeout(() => {
        isAnimating = false;
      }, animationDuration);
    };
    
    // 同步真输入框的值到假输入框
    function syncToFake() {
      if (!isMobile) return;
      
      const fakeText = fakeInput.querySelector('.fake-text');
      const fakeCursor = fakeInput.querySelector('.fake-cursor');
      const value = secretInput.value;
      
      if (value.length > 0) {
        fakeText.textContent = value;
        fakeText.style.color = '#1d1d1f';
        fakeText.classList.remove('placeholder');
      } else {
        fakeText.textContent = 'type something...';
        fakeText.style.color = 'rgba(0, 0, 0, 0.3)';
        fakeText.classList.add('placeholder');
      }
    }
    
    // 实时同步输入内容
    secretInput.addEventListener('input', () => {
      syncToFake();
    });
    
    secretInput.addEventListener('input', () => {
      syncToFake();
      
      // 原有的 lift 逻辑
      if (secretInput.value.length > 0) {
        secretInput.classList.add('lift');
        inputWrapper.classList.add('lift');
        secretContainer.classList.add('active');
        syncLiftState(true);
      } else {
        secretInput.classList.remove('lift');
        inputWrapper.classList.remove('lift');
        secretContainer.classList.remove('active');
        syncLiftState(false);
      }
    });

    secretInput.addEventListener('focus', () => {
      isInputFocused = true;
      
      if (isMobile) {
        // 假输入框加 lift 和 focused 状态（显示光标和动画）
        fakeInput.classList.add('lift', 'focused');
        inputWrapper.classList.add('lift');
        secretContainer.classList.add('active');
        
        // 第三页时指示器淡出
        if (currentPage === 2) {
          const indicators = document.querySelector('.page-indicators');
          indicators.style.opacity = '0';
        }
      } else {
        // 桌面端原有逻辑
        secretInput.classList.add('lift');
        inputWrapper.classList.add('lift');
        secretContainer.classList.add('active');
      }
    });

    secretInput.addEventListener('blur', () => {
      
      const hasValue = secretInput.value.length > 0;
      
      if (isMobile) {
        // 同步内容到假输入框
        syncToFake();
        
        // 移除假输入框的 focused 状态（隐藏光标）
        fakeInput.classList.remove('focused');
        
        if (!hasValue) {
          fakeInput.classList.remove('lift');
          inputWrapper.classList.remove('lift');
          secretContainer.classList.remove('active');
        }
        
        // 第三页时指示器淡入
        if (currentPage === 2) {
          setTimeout(() => {
            const indicators = document.querySelector('.page-indicators');
            indicators.style.opacity = '1';
          }, 200);
        }
      } else {
        // 桌面端
        if (!hasValue) {
          secretInput.classList.remove('lift');
          inputWrapper.classList.remove('lift');
          secretContainer.classList.remove('active');
        }
      }
      
      setTimeout(() => {
        isInputFocused = false;
      }, 150);
    });
    
    // 只在非输入状态且高度稳定时才更新固定高度
    let resizeTimeout = null;
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768) return;
      if (isInputFocused) return;
      
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (!isInputFocused) {
          lockAllSections();
        }
      }, 500);
    });

    // ==================== 原有功能代码 ====================
    const cardContainer = document.getElementById('cardContainer');
    const card = document.getElementById('card');

    // 桌面端输入框 input 事件（用于检测内容变化）
    if (!isMobile) {
      secretInput.addEventListener('input', () => {
        if (secretInput.value.length > 0) {
          secretInput.classList.add('lift');
          inputWrapper.classList.add('lift');
          secretContainer.classList.add('active');
        } else {
          secretInput.classList.remove('lift');
          inputWrapper.classList.remove('lift');
          secretContainer.classList.remove('active');
        }
      });
    }

    // 按钮 hover 效果（仅桌面端）
    if (!isMobile) {
      secretBtn.addEventListener('mouseenter', () => {
        secretBtn.classList.add('lift');
        btnWrapper.classList.add('lift');
      });

      secretBtn.addEventListener('mouseleave', () => {
        secretBtn.classList.remove('lift');
        btnWrapper.classList.remove('lift');
      });
    }
    
    // 按钮触摸效果（仅移动端）- 按下浮起，松开落下
    if (isMobile) {
      secretBtn.addEventListener('touchstart', (e) => {
        secretBtn.classList.add('lift');
        btnWrapper.classList.add('lift');
      }, { passive: true });
      
      secretBtn.addEventListener('touchend', (e) => {
        secretBtn.classList.remove('lift');
        btnWrapper.classList.remove('lift');
      }, { passive: true });
      
      secretBtn.addEventListener('touchcancel', (e) => {
        secretBtn.classList.remove('lift');
        btnWrapper.classList.remove('lift');
      }, { passive: true });
    }

    // 名片翻转
    let flipCount = 0;
    card.addEventListener('click', () => {
      flipCount++;
      card.style.transform = `rotateY(${flipCount * 180}deg)`;
    });

    // 名片 3D 效果
    let currentRotation = { x: 0, y: 0 };
    let targetRotation = { x: 0, y: 0 };
    let initialOrientation = null;
    let orientationCalibrated = false;

    document.addEventListener('mousemove', (e) => {
      if (window.innerWidth < 768) return;
      if (currentPage !== 0) return; // 只在第一页响应

      const rect = cardContainer.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;

      const deltaX = e.clientX - centerX;
      const deltaY = e.clientY - centerY;

      const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
      const maxDistance = 400;
      const intensity = Math.max(0, 1 - distance / maxDistance);

      const maxRotation = 25;
      const rotationY = (deltaX / rect.width) * 20 * intensity;
      const rotationX = -(deltaY / rect.height) * 20 * intensity;
      
      targetRotation.y = Math.max(-maxRotation, Math.min(maxRotation, rotationY));
      targetRotation.x = Math.max(-maxRotation, Math.min(maxRotation, rotationX));
    });

    // 陀螺仪支持
    let orientationStarted = false;
    let orientationSamples = [];

    const handleOrientation = (e) => {
      if (window.innerWidth >= 768) return;
      if (currentPage !== 0) return;
      if (e.beta === null || e.gamma === null) return;

      // 校准阶段：收集样本
      if (!orientationCalibrated) {
        orientationSamples.push({ beta: e.beta, gamma: e.gamma });
        
        // 收集10个样本后，取最后5个的平均值作为初始值
        if (orientationSamples.length >= 10) {
          const lastFive = orientationSamples.slice(-5);
          const avgBeta = lastFive.reduce((sum, s) => sum + s.beta, 0) / 5;
          const avgGamma = lastFive.reduce((sum, s) => sum + s.gamma, 0) / 5;
          
          initialOrientation = { beta: avgBeta, gamma: avgGamma };
          orientationCalibrated = true;
        }
        return;
      }

      const deltaGamma = e.gamma - initialOrientation.gamma;
      const deltaBeta = e.beta - initialOrientation.beta;

      const maxRotation = 25;
      targetRotation.y = Math.max(-maxRotation, Math.min(maxRotation, deltaGamma * 1.5));
      targetRotation.x = Math.max(-maxRotation, Math.min(maxRotation, -deltaBeta * 1.5));
    };

    const startOrientation = () => {
      if (orientationStarted) return;
      orientationStarted = true;
      
      initialOrientation = null;
      orientationCalibrated = false;
      orientationSamples = [];
      currentRotation = { x: 0, y: 0 };
      targetRotation = { x: 0, y: 0 };
      
      window.addEventListener('deviceorientation', handleOrientation, true);
      window.addEventListener('deviceorientationabsolute', handleOrientation, true);
    };

    const requestPermission = () => {
      if (typeof DeviceOrientationEvent !== 'undefined' && 
          typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
          .then(response => {
            if (response === 'granted') {
              startOrientation();
            }
          })
          .catch(err => {
          });
      } else {
        startOrientation();
      }
    };

    if (window.innerWidth < 768) {
      if (typeof DeviceOrientationEvent !== 'undefined' && 
          typeof DeviceOrientationEvent.requestPermission === 'function') {
        // iOS 需要用户交互才能请求权限
        const handleFirstInteraction = () => {
          requestPermission();
        };
        document.addEventListener('touchend', handleFirstInteraction, { once: true });
      } else {
        // 安卓直接启动
        requestPermission();
      }
    }

    function animateRotation() {
      currentRotation.x += (targetRotation.x - currentRotation.x) * 0.1;
      currentRotation.y += (targetRotation.y - currentRotation.y) * 0.1;

      cardContainer.style.transform = `rotateX(${currentRotation.x}deg) rotateY(${currentRotation.y}deg)`;
      requestAnimationFrame(animateRotation);
    }
    animateRotation();

    // 彩蛋 API
    const EASTER_EGG_API = 'https://api.720901.xyz';
    
    // 预加载的彩蛋数据
    let eggsCache = {};
    let eggsLoading = false;
    
    // 预加载所有彩蛋（进入第二页时调用）
    async function preloadEggs() {
      if (eggsLoading || Object.keys(eggsCache).length > 0) return;
      eggsLoading = true;
      try {
        const res = await fetch(`${EASTER_EGG_API}/eggs`);
        if (res.ok) {
          const eggs = await res.json();
          eggs.forEach(egg => {
            eggsCache[egg.keyword.toLowerCase()] = egg;
          });
        }
      } catch (err) {
        eggsLoading = false;
      }
    }

    // 提交功能（点击按钮或回车）
    function handleSubmit() {
      const value = secretInput.value.toLowerCase().trim();
      
      // 先清空输入框
      secretInput.value = '';
      secretInput.classList.remove('lift');
      inputWrapper.classList.remove('lift');
      secretContainer.classList.remove('active');
      
      // 同步清空假输入框
      if (isMobile) {
        syncToFake();
        fakeInput.classList.remove('lift', 'focused');
      }
      
      // 收起键盘
      secretInput.blur();
      
      // 本地查询彩蛋
      if (value) {
        const egg = eggsCache[value];
        if (egg && egg.elements && egg.elements.length > 0) {
          triggerEasterEgg(egg.elements);
        }
      }
    }

    secretBtn.addEventListener('click', handleSubmit);
    secretInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        handleSubmit();
      }
    });

    // 触发彩蛋动画
    function triggerEasterEgg(elements) {
      elements.forEach((el, index) => {
        setTimeout(() => {
          playElement(el, index);
        }, (el.delay || 0) * 1000);
      });
    }

    // 播放单个元素
    function playElement(el, zIndex = 0) {
      const sizeMap = { small: 50, medium: 100, large: 180, xlarge: 280, xxlarge: 400, xxxlarge: 550 };
      const size = sizeMap[el.size] || sizeMap.medium;

      const container = document.createElement('div');
      container.style.cssText = `
        position: fixed; top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        z-index: ${1000 + zIndex}; pointer-events: none;
        animation: eggFadeIn 0.3s ease-out;
      `;

      if (el.type === 'emoji') {
        container.style.fontSize = size + 'px';
        container.textContent = el.value;
        document.body.appendChild(container);
        setTimeout(() => {
          container.style.animation = 'eggFadeOut 0.5s ease-out forwards';
          setTimeout(() => container.remove(), 500);
        }, 2000);

      } else if (el.type === 'lucide') {
        container.innerHTML = getLucideSvg(el.value, size);
        document.body.appendChild(container);
        setTimeout(() => {
          container.style.animation = 'eggFadeOut 0.5s ease-out forwards';
          setTimeout(() => container.remove(), 500);
        }, 2000);

      } else if (el.type === 'lottie' && el.value) {
        const player = document.createElement('lottie-player');
        player.setAttribute('src', el.value);
        player.setAttribute('background', 'transparent');
        player.setAttribute('speed', '1');
        player.style.width = size + 'px';
        player.style.height = size + 'px';
        container.appendChild(player);
        document.body.appendChild(container);
        
        player.addEventListener('ready', () => player.play());
        player.addEventListener('complete', () => {
          container.style.animation = 'eggFadeOut 0.3s ease-out forwards';
          setTimeout(() => container.remove(), 300);
        });
        setTimeout(() => { if (container.parentNode) container.remove(); }, 5000);
      }
    }

    // Lucide 图标 SVG
    function getLucideSvg(name, size) {
      const svgs = {
        'heart': '<path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>',
        'star': '<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>',
        'sun': '<circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>',
        'moon': '<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>',
        'sparkles': '<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3zM5 3v4M19 17v4M3 5h4M17 19h4"/>',
        'flame': '<path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>',
        'rocket': '<path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09zM12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2zM9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>',
        'gift': '<polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" x2="12" y1="22" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7zM12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>'
      };
      const path = svgs[name] || svgs['heart'];
      return `<svg viewBox="0 0 24 24" width="${size}" height="${size}" fill="none" stroke="#1d1d1f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${path}</svg>`;
    }

    function triggerOldEasterEgg() {
      const heart = document.createElement('div');
      heart.className = 'easter-egg';
      heart.textContent = '❤️';
      document.body.appendChild(heart);

      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          createFirework();
        }, i * 60);
      }

      setTimeout(() => {
        heart.remove();
      }, 3000);
    }

    function createFirework() {
      const colors = ['#ff0000', '#ff6b6b', '#ff8787', '#ffa5a5', '#ffc9c9'];
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;

      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'firework';
        particle.style.left = centerX + 'px';
        particle.style.top = centerY + 'px';
        particle.style.background = colors[Math.floor(Math.random() * colors.length)];
        document.body.appendChild(particle);

        const angle = (Math.PI * 2 * i) / 30;
        const velocity = 2 + Math.random() * 3;
        const vx = Math.cos(angle) * velocity;
        const vy = Math.sin(angle) * velocity;

        let x = centerX;
        let y = centerY;
        let opacity = 1;

        function animateParticle() {
          x += vx;
          y += vy;
          opacity -= 0.02;

          particle.style.left = x + 'px';
          particle.style.top = y + 'px';
          particle.style.opacity = opacity;

          if (opacity > 0) {
            requestAnimationFrame(animateParticle);
          } else {
            particle.remove();
          }
        }

        animateParticle();
      }
    }

    // 初始化第一页状态
    sections[0].classList.add('active');
  </script>

</body>
</html>
